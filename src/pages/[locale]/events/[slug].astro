---
export const prerender = true;

import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import MainLayout from "@/layouts/MainLayout.astro";
import * as m from "@/paraglide/messages";

export async function getStaticPaths() {
  const allEvents = await getCollection("events");

  return allEvents.map((event) => {
    const locale = event.id.split("/")[0];

    return {
      params: {
        locale,
        slug: event.slug.replace(`${locale}/`, ""),
      },
      props: { event },
    };
  });
}

const { event } = Astro.props;
const currentLocale = Astro.currentLocale;
const { Content } = await event.render();
---

<MainLayout title={event.data.title} description={event.data.description}>
  <article class="py-12 bg-white">
    <div class="container mx-auto px-4 max-w-4xl">
      <div class="relative h-80 md:h-96 w-full mb-8 rounded-xl overflow-hidden">
        {
          event.data.image ? (
            <Image
              src={event.data.image}
              alt={event.data.title}
              class="h-full w-full object-cover"
              loading="eager"
              width={300}
              height={200}
            />
          ) : (
            <div class="h-full w-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-400 text-xl">{m.events_noImage()}</span>
            </div>
          )
        }
      </div>

      <header class="mb-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{event.data.title}</h1>

        <div class="bg-gray-100 p-5 rounded-lg mb-8">
          <p class="text-xl">{event.data.description}</p>
        </div>
      </header>

      <!-- Event content -->
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>

      <!-- Back to events button -->
      <div class="mt-12 text-center">
        <a
          href={`/${currentLocale}/events`}
          class="inline-block px-8 py-3 border-2 border-black text-black font-medium rounded-md hover:bg-black hover:text-white transition-colors duration-300"
        >
          ‚Üê {m.nav_events()}
        </a>
      </div>
    </div>
  </article>
</MainLayout>
