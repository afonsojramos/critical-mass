---
export const prerender = true;

import { getCollection } from "astro:content";
import EventCarousel from "@/components/ui/EventCarousel.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import * as m from "@/paraglide/messages";

export async function getStaticPaths() {
  const allEvents = await getCollection("events");

  return allEvents.map((event) => {
    const locale = event.id.split("/")[0];

    return {
      params: {
        locale,
        slug: event.slug.replace(`${locale}/`, ""),
      },
      props: { event },
    };
  });
}

const { event } = Astro.props;
const { Content } = await event.render();
---

<MainLayout title={event.data.title} description={event.data.description}>
  <article class="py-12 bg-white">
    <div class="container mx-auto max-w-4xl">
      <div class="relative h-80 md:h-96 w-full mb-8 rounded-xl overflow-hidden">
        {
          event.data.images && event.data.images.length > 0 ? (
            <EventCarousel
              images={event.data.images}
              eventTitle={event.data.title}
            />
          ) : (
            <div class="h-full w-full bg-gray-200 flex items-center justify-center">
              <span class="text-gray-400 text-xl">{m.events_noImage()}</span>
            </div>
          )
        }
      </div>

      <header class="mb-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">{event.data.title}</h1>

        <div class="bg-gray-100 p-5 rounded-lg mb-8">
          <p class="text-xl">{event.data.description}</p>
        </div>
      </header>

      <!-- Event content -->
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </div>
  </article>
</MainLayout>
